{
  "version": 3,
  "sources": ["../src/index.js"],
  "sourcesContent": ["import fs from 'fs'\r\nimport dayjs from 'dayjs'\r\n////import isoWeek from 'dayjs/plugin/isoWeek.js'\r\n\r\nconst path = 'lib/logger'\r\n\r\nexport const LEVELS = { TRACE: 1, DEBUG: 2, INFO: 3, WARN: 4, ERROR: 5, OFF: 99 }//ALL < |TRACE < DEBUG < INFO < WARN < ERROR| < FATAL < MARK < OFF\r\nexport const ROTATE = { HOURLY: 'hourly', DAILY: 'daily', WEEKLY: 'weekly', MONTHLY: 'monthly' }\r\n\r\nclass Logger {\r\n  break = []\r\n  level = 0\r\n  console = {}\r\n  file = false\r\n  name = false\r\n  hideSecrets = false\r\n\r\n  config({ file, name = 'my logger', displayConsole = false, level = LEVELS.TRACE, hideSecrets = true, rotate = 'daily', breaks = [] }) {\r\n    this.file = file\r\n    this.name = name\r\n    this.console = {\r\n      display: displayConsole,\r\n      log: console.log,\r\n      warn: console.warn,\r\n      error: console.error,\r\n    }\r\n    this.level = level\r\n    this.hideSecrets = hideSecrets\r\n    this.break = breaks\r\n    this.rotate = rotate\r\n    //name = this\r\n  }\r\n\r\n  addBreak(break_) {\r\n    this.break.push(break_)\r\n    this.info(path, 'addBreak', this.break)\r\n  }\r\n\r\n  setName(name) {\r\n    this.name = name\r\n  }\r\n\r\n  /*name(){\r\n    return this.file.substring(this.file.indexOf('data/')+5)\r\n  }*/\r\n\r\n  trace(...rest) {\r\n    rest.unshift('TRACE')\r\n    this.log(rest)\r\n  }\r\n\r\n  debug(...rest) {\r\n    rest.unshift('DEBUG')\r\n    this.log(rest)\r\n  }\r\n\r\n  info(...rest) {\r\n    rest.unshift('INFO')\r\n    this.log(rest)\r\n  }\r\n\r\n  warn(...rest) {\r\n    rest.unshift('WARN')\r\n    this.log(rest)\r\n  }\r\n\r\n  error(...rest) {\r\n    rest.unshift('ERROR')\r\n    this.log(rest)\r\n  }\r\n\r\n  log(rest) {\r\n    rest = this.filterLogger(rest)\r\n    //rest = this.nodemailer(rest)\r\n    const level = rest.shift()\r\n    const path = rest.shift()\r\n    if ((this.break.length == 0 && this.level <= LEVELS[level]) || this.break.includes(path) || ['ERROR', 'FATAL'].includes(level)) {\r\n      //const name = this.name ? this.name.indexOf(']') > -1 ? this.name : '[' + this.name + ']' : ''\r\n      ////let tmp = '['+dayjs().format('YYYY-MM-DD HH:mm:ss')+']['+level+']'+name+'['+path+'] - '+rest.map(r=>{return (typeof r=='string')?r:JSON.stringify(r)}).join(', ').replaceAll(`\\\\\"`, `\"`).replaceAll(`\\\\\\\\`, '')\r\n      ////let tmp = ['['+dayjs().format('HH:mm:ss')+']','['+level+']', name, '['+path+']', rest.map(r=>{return (typeof r=='string')?r:JSON.stringify(r)}).join(', ').replaceAll(`\\\\\"`, `\"`).replaceAll(`\\\\\\\\`, '')]\r\n      //let tmp = ['[' + dayjs().format('HH:mm:ss') + ']', '[' + level + ']', name, '[' + path + ']', ...rest]\r\n      let tmp = []\r\n      if (this.name) {\r\n        tmp = ['[' + dayjs().format('HH:mm:ss') + ']', '[' + level + ']', this.name, '[' + path + ']', ...rest]\r\n      } else {\r\n        tmp = ['[' + dayjs().format('HH:mm:ss') + ']', '[' + level + ']', '[' + path + ']', ...rest]\r\n      }\r\n      if (this.console.display || ['ERROR', 'FATAL'].includes(level)) {\r\n        if (['ERROR', 'FATAL'].includes(level)) {\r\n          this.console.error(...tmp)\r\n        } else if (['WARN'].includes(level)) {\r\n          this.console.warn(...tmp)\r\n        } else {\r\n          this.console.log(...tmp)\r\n        }\r\n      }\r\n      if (this.file) {\r\n        //tmp  = '['+dayjs().format('YYYY-MM-DD HH:mm:ss')+']['+level+']'+logger+'['+path+'] - '+rest.map(r=>{return (typeof r=='string')?r:JSON.stringify(r)}).join(', ').replaceAll(`\\\\\"`, `\"`).replaceAll(`\\\\\\\\`, '')\r\n        tmp.shift()\r\n        tmp = ['[' + dayjs().format('YYYY-MM-DD HH:mm:ss') + ']', ...tmp]\r\n        this.writeFile(this.file, tmp)\r\n      }\r\n    }\r\n  }\r\n\r\n  writeFile(fn, data) {\r\n    const dir = fn.split(\"/\").slice(0, -1).join('/')\r\n    if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true })\r\n    if (this.rotate) {\r\n      let date\r\n      switch (this.rotate) {\r\n        case ROTATE.MONTHLY:\r\n          date = dayjs().format('YYYY-MM');\r\n          break;\r\n        case ROTATE.HOURLY:\r\n          date = dayjs().format('YYYY-MM-DD HH');\r\n          break;\r\n        case ROTATE.DAILY:\r\n        default:\r\n          date = dayjs().format('YYYY-MM-DD');\r\n          break;\r\n        //case ROTATE.WEEKLY: <--se requien mucho plugins\r\n        //  dayjs.extend(isoWeek);\r\n        //  const week = dayjs().isoWeek();\r\n        //  date = dayjs().format('YYYY-') + week;\r\n        //  break;\r\n      }\r\n      fn = fn.replace('.log', `-${date}.log`)\r\n    }\r\n    fs.appendFile(fn, data + '\\n', (err) => { if (err) { this.console.error('logger writeFile', err) } })\r\n  }\r\n\r\n  static get levels() {\r\n    return LEVELS\r\n  }\r\n\r\n  /*nodemailer(rest){\r\n    if(typeof rest[1]=='object'){\r\n      let tmp = []\r\n      if(rest[2].indexOf('%s')>=0){\r\n        for(let x=3;x<rest.length;x++){\r\n          tmp.push(rest[x])\r\n        }\r\n        rest[2] = this.formatLog(rest[2], tmp)\r\n      }\r\n      tmp = [rest[0], 'nodemailer']\r\n      if(rest[1]?.sid){\r\n        tmp.push('['+rest[1]?.sid+']')\r\n      }\r\n      tmp.push(rest[2])\r\n      rest = tmp\r\n    }\r\n    return rest\r\n  }\r\n\r\n  formatLog(message, values){\r\n    const tmp = message.replace(/%[sd]/g, () => values.shift());\r\n    return tmp\r\n  }*/\r\n\r\n  filterLogger(rest) {\r\n    for (let r = 0; r < rest.length; r++) {\r\n      if (rest[r]?.constructor?.name == 'Logger') {\r\n        rest.splice(r, 1)\r\n      } else if (rest[r]?.logger) {\r\n        delete rest[r].logger\r\n      } else if (rest[r]?.cert) {\r\n        rest[r].cert = rest[r].cert.substring(0, 10) + '...' + rest[r].cert.substring(rest[r].cert.length - 10)\r\n      } else if (rest[r]?.password) {\r\n        rest[r].password = rest[r].password.replace(rest[r].password, '*')\r\n      } else if (rest[r]?.pass && !this.hideSecrets) {\r\n        rest[r].pass = rest[r].pass.replace(rest[r].pass, '*')\r\n      } else if (rest[r]?.clave && !this.hideSecrets) {\r\n        rest[r].clave = rest[r].clave.replace(rest[r].clave, '*')\r\n      } else if (rest[r]?.token && !this.hideSecrets) {\r\n        rest[r].token = rest[r].token.replace(rest[r].token, '*')\r\n      } else if (rest[r] instanceof Error) {\r\n        rest[r] = rest[r]?.message + `\\nstack:` + rest[r]?.stack\r\n      } else if (typeof rest[r] == 'object') {\r\n        rest[r] = JSON.stringify(rest[r])\r\n      } else if (Array.isArray(rest[r])) {\r\n        rest[r] = rest[r].join(',')\r\n      }\r\n    }\r\n\r\n    return rest\r\n  }\r\n}\r\n\r\nexport function createLogger({ file, name = 'my logger', displayConsole = false, level = LEVELS.TRACE, rotate = 'daily', breaks = [] }) {\r\n  logger.config({ file, name, displayConsole, level, rotate, breaks })\r\n}\r\nexport const logger = new Logger()\r\n"],
  "mappings": "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",
  "names": ["path", "dayjs", "fs"]
}
